---
# Mnemonic Plugin Functional Test Suite
# Generated by auto-harness
# Format: YAML test definitions
#
# Test Schema:
#   id: unique_identifier (required)
#   description: human-readable explanation (required)
#   category: grouping for filtering
#   action: instruction for Claude to execute (required)
#   expect: array of validation rules (required)
#     - contains: text that must appear
#     - not_contains: text that must NOT appear
#     - regex: pattern to match (use capture groups for save_as)
#   save_as: variable name to store captured value
#   depends_on: id of prerequisite test
#   tags: array of labels for filtering

version: "1.0"
description: "Mnemonic Plugin Functional Test Suite"
generated_by: auto-harness

tests:
  # ==========================================================================
  # Smoke Tests - Quick sanity checks
  # ==========================================================================

  - id: smoke_basic
    description: Basic smoke test to verify test framework is working
    category: smoke
    action: |
      Confirm the test framework is operational by responding with
      'Test framework operational'
    expect:
      - contains: "operational"
      - not_contains: "error"
    tags: [smoke, critical]

  # ==========================================================================
  # Command Tests - /mnemonic:* commands
  # ==========================================================================

  - id: cmd_init_basic
    description: Initialize mnemonic directory structure
    category: commands
    action: |
      Run the /mnemonic:init command to initialize the mnemonic
      directory structure.
    expect:
      - not_contains: "error"
      - not_contains: "failed"
    tags: [smoke, commands, init]

  - id: cmd_status_basic
    description: Show mnemonic system status
    category: commands
    action: |
      Run the /mnemonic:status command to display current mnemonic
      system status.
    expect:
      - not_contains: "error"
    tags: [smoke, commands, status]

  - id: cmd_capture_basic
    description: Capture a new memory entry
    category: commands
    action: |
      Run the /mnemonic:capture command to create a test memory with
      content 'Test memory for automated testing' in the 'testing'
      namespace.
    expect:
      - not_contains: "error"
      - not_contains: "failed"
    tags: [smoke, commands, capture, crud]

  - id: cmd_search_basic
    description: Search for memories using keywords
    category: commands
    action: |
      Run the /mnemonic:search command to search for memories
      containing 'test' keyword.
    expect:
      - not_contains: "error"
    tags: [smoke, commands, search]

  - id: cmd_search_enhanced_basic
    description: Enhanced agent-driven search
    category: commands
    action: |
      Run the /mnemonic:search-enhanced command to perform an
      enhanced search for 'test memory'.
    expect:
      - not_contains: "error"
    tags: [commands, search]

  - id: cmd_recall_basic
    description: Recall memories with filtering
    category: commands
    action: |
      Run the /mnemonic:recall command to list recent memories.
    expect:
      - not_contains: "error"
    tags: [smoke, commands, recall]

  - id: cmd_setup_basic
    description: Configure mnemonic settings
    category: commands
    action: |
      Run the /mnemonic:setup command to view or configure
      mnemonic settings.
    expect:
      - not_contains: "error"
    tags: [commands, setup]

  - id: cmd_gc_basic
    description: Garbage collect expired memories
    category: commands
    action: |
      Run the /mnemonic:gc command to clean up expired memories.
    expect:
      - not_contains: "error"
    tags: [commands, gc]

  # ==========================================================================
  # Skill Tests - Semantic skill triggers
  # ==========================================================================

  - id: skill_core_trigger
    description: Test mnemonic-core skill trigger
    category: skills
    action: |
      Test the mnemonic-core skill by asking:
      'How do I capture a memory in mnemonic?'
    expect:
      - not_contains: "error"
    tags: [smoke, skills]

  - id: skill_format_trigger
    description: Test mnemonic-format skill trigger
    category: skills
    action: |
      Test the mnemonic-format skill by asking:
      'What is the memory file format for mnemonic?'
    expect:
      - not_contains: "error"
    tags: [skills]

  - id: skill_organization_trigger
    description: Test mnemonic-organization skill trigger
    category: skills
    action: |
      Test the mnemonic-organization skill by asking:
      'How should I organize memories by namespace?'
    expect:
      - not_contains: "error"
    tags: [skills]

  - id: skill_search_trigger
    description: Test mnemonic-search skill trigger
    category: skills
    action: |
      Test the mnemonic-search skill by asking:
      'How do I search for memories in mnemonic?'
    expect:
      - not_contains: "error"
    tags: [skills]

  - id: skill_setup_trigger
    description: Test mnemonic-setup skill trigger
    category: skills
    action: |
      Test the mnemonic-setup skill by asking:
      'How do I set up mnemonic for a new project?'
    expect:
      - not_contains: "error"
    tags: [skills]

  - id: skill_blackboard_trigger
    description: Test mnemonic-blackboard skill trigger
    category: skills
    action: |
      Test the mnemonic-blackboard skill by asking:
      'How does the blackboard pattern work in mnemonic?'
    expect:
      - not_contains: "error"
    tags: [skills]

  - id: skill_agent_coordination_trigger
    description: Test mnemonic-agent-coordination skill trigger
    category: skills
    action: |
      Test the mnemonic-agent-coordination skill by asking:
      'How do agents coordinate using mnemonic?'
    expect:
      - not_contains: "error"
    tags: [skills]

  - id: skill_search_enhanced_trigger
    description: Test mnemonic-search-enhanced skill trigger
    category: skills
    action: |
      Test the mnemonic-search-enhanced skill by asking:
      'Perform an enhanced semantic search for project context'
    expect:
      - not_contains: "error"
    tags: [skills]

  # ==========================================================================
  # Agent Tests - Subagent task execution
  # ==========================================================================

  - id: agent_memory_curator_basic
    description: Test memory-curator agent launch
    category: agents
    action: |
      Launch the memory-curator agent with task:
      'List the current memory namespaces and their counts'
    expect:
      - not_contains: "error"
      - not_contains: "failed to launch"
    tags: [agents, curator]

  - id: agent_search_subcall_basic
    description: Test mnemonic-search-subcall agent launch
    category: agents
    action: |
      Launch the mnemonic-search-subcall agent with task:
      'Search for memories related to testing'
    expect:
      - not_contains: "failed to launch"
      - not_contains: "agent not found"
    tags: [agents, search]

  - id: agent_compression_worker_basic
    description: Test compression-worker agent launch
    category: agents
    action: |
      Launch the compression-worker agent with task:
      'Compress verbose memory entries in the testing namespace'
    expect:
      - not_contains: "error"
      - not_contains: "failed to launch"
    tags: [agents, compression]

  # ==========================================================================
  # Integration Tests - End-to-end workflows
  # ==========================================================================

  - id: integration_crud_create
    description: Create a test memory for CRUD chain
    category: integration
    action: |
      Create a new semantic memory with:
      - Title: 'Integration Test Memory'
      - Content: 'This memory was created for integration testing'
      - Namespace: testing
      - Tags: integration, crud, test
    expect:
      - not_contains: "error"
      - regex: "[a-f0-9-]{36}"
    save_as: test_memory_id
    tags: [integration, crud]

  - id: integration_crud_read
    description: Read the created test memory
    category: integration
    action: |
      Search for and read the memory with ID containing
      '${test_memory_id}' or search for memories with tag
      'integration'.
    depends_on: integration_crud_create
    expect:
      - contains: "Integration Test Memory"
    tags: [integration, crud]

  - id: integration_crud_cleanup
    description: Verify cleanup operations
    category: integration
    action: |
      Run /mnemonic:gc with dry-run to see what would be cleaned up.
    depends_on: integration_crud_read
    expect:
      - not_contains: "error"
    tags: [integration, crud]

  # ==========================================================================
  # Error Handling Tests
  # ==========================================================================

  - id: error_invalid_namespace
    description: Test handling of invalid namespace
    category: errors
    action: |
      Attempt to search in a non-existent namespace
      'nonexistent_namespace_xyz' and verify graceful handling.
    expect:
      - not_contains: "exception"
      - not_contains: "traceback"
    tags: [errors, negative]

  - id: error_malformed_memory
    description: Test handling of malformed memory input
    category: errors
    action: |
      Attempt to create a memory with empty content and verify
      it's handled gracefully.
    expect:
      - not_contains: "exception"
      - not_contains: "traceback"
    tags: [errors, negative]
